<mat-dialog-content>
  <div class="p-4">
    <div class="flex justify-between items-center mb-4">
      <h2 mat-dialog-title>
        {{ isNewSpace ? 'New Parking Space' : 'Parking Space Details' }}
        <span *ngIf="!isNewSpace"> #{{ parkingDetail.id }}</span>
      </h2>
      <button 
        *ngIf="!isNewSpace && !isEditMode" 
        mat-icon-button 
        color="primary" 
        (click)="editSpace()"
        matTooltip="Edit Space"
      >
        <mat-icon>edit</mat-icon>
      </button>
    </div>

    <!-- Basic Information Card -->
    <mat-card class="mb-6 shadow-md">
      <mat-card-header class="bg-primary/10 px-4 py-3">
        <br>
        <mat-card-title class="text-lg font-medium">Basic Information</mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
          <!-- Parking ID -->
          <div class="form-field-container">
            <br>
            <label class="block text-sm font-medium text-gray-700 mb-1">Parking ID</label>
            <div class="bg-gray-50 p-2 rounded border border-gray-200">
              {{ parkingDetail.id || 'Creating' }}
            </div>
          </div>

          <!-- Type -->
          <div class="form-field-container">
            <br>
            <label class="block text-sm font-medium text-gray-700 mb-1">Space Type</label> 
            <div class="flex">
              <div *ngIf="!isEditMode" class="bg-gray-50 p-2 rounded border border-gray-200 w-full">
                <div class="font-medium">{{ formatType(parkingDetail.typeDetail.type) }}</div>
                <div class="text-sm text-gray-500 space-y-2"> 
                  <div class="flex justify-between">
                    <br>
                    <span class="font-medium">Charging Rate: </span> 
                    <span>{{ parkingDetail.typeDetail.rate }} CNY/kWh</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="font-medium">Parking Rate: </span> 
                    <span>{{ parkingDetail.typeDetail.parking_rate }} CNY/hour</span> 
                  </div>
                  <div class="flex justify-between">
                    <span class="font-medium">Overtime Occupancy Rate: </span> 
                    <span>{{ parkingDetail.typeDetail.overtime_occupancy_rate }} CNY/min</span> 
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Status -->
          <div class="form-field-container">
            <br>
            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <div class="flex">
              <div class="bg-gray-50 p-2 rounded border border-gray-200 w-full">
                {{ formatStatus(parkingDetail.status) }}
              </div>
            </div>
          </div>

          <!-- Vehicle ID -->
          <div class="form-field-container">
            <br>
            <label class="block text-sm font-medium text-gray-700 mb-1">Vehicle ID</label>
            <div class="bg-gray-50 p-2 rounded border border-gray-200">
              {{ parkingDetail.vehicle_id || 'no vehicles parked' }}
            </div>
          </div>

          <!-- Time Information -->
          <div class="form-field-container col-span-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <br>
                <label class="block text-sm font-medium text-gray-700 mb-1">Created At</label>
                <div>{{ formatDate(parkingDetail.created_at) }}</div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Updated At</label>
                <div>{{ formatDate(parkingDetail.updated_at) }}</div>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Usage Records -->
    <mat-card class="shadow-md mb-6">
      <mat-card-header class="bg-primary/10 px-4 py-3">
        <mat-card-title class="text-lg font-medium">
          Usage Records ({{ parkingDetail.usageRecords.length }})
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div *ngIf="parkingDetail.usageRecords.length === 0" class="text-center py-6 text-gray-500">
          No usage records found
        </div>
        <div *ngFor="let record of parkingDetail.usageRecords" class="mb-6 p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
          <div class="space-y-2">
            <div class="flex justify-between">
              <br>
              <span class="font-medium">Record ID: </span>
              <span>{{ record.id }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Start Time: </span>
              <span>{{ formatDate(record.start_time) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Charging Start: </span>
              <span>{{ record.charging_start_time ? formatDate(record.charging_start_time) : 'N/A' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Charging End: </span>
              <span>{{ record.charging_complete_time ? formatDate(record.charging_complete_time) : 'N/A' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">End Time: </span>
              <span>{{ record.end_time ? formatDate(record.end_time) : '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Status: </span>
              <span>{{ formatStatus(record.status) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Electricity Used: </span>
              <span>{{ record.electricity_used }} kWh</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Total Fee: </span>
              <span>{{ record.total_fee | currency:'CNY' }}</span> 
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Parking Minutes: </span>
              <span>{{ record.parking_minutes }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Overtime Minutes: </span>
              <span>{{ record.overtime_minutes }}</span>
            </div>
          </div>
          <div class="mt-6 h-px bg-gray-200" *ngIf="!last"></div> 
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Bookings -->
    <br>
    <mat-card class="shadow-md mb-6">
      <mat-card-header class="bg-primary/10 px-4 py-3">
        <mat-card-title class="text-lg font-medium">
          Bookings ({{ parkingDetail.bookings.length }})
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div *ngIf="parkingDetail.bookings.length === 0" class="text-center py-6 text-gray-500">
          No booking records found
        </div>
        <div *ngFor="let booking of parkingDetail.bookings" class="mb-6 p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
          <div class="space-y-2">
            <div class="flex justify-between">
              <br>
              <span class="font-medium">Booking ID: </span>
              <span>{{ booking.id }}</span>
            </div>
             <div class="flex justify-between">
              <span class="font-medium">User Name:</span>
              <span>{{ booking.name || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Phone:</span>
              <span>{{ booking.phone || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">License Plate:</span>
              <span>{{ booking.license_plate || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Booking Time: </span>
              <span>{{ formatDate(booking.created_at) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Time Range: </span>
              <span>{{ formatDate(booking.start_time) }} - {{ formatDate(booking.end_time) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Status: </span>
              <span>{{ formatStatus(booking.status) }}</span>
            </div>
          </div>
          <div class="mt-6 h-px bg-gray-200" *ngIf="!last"></div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Comments -->
    <br>
    <mat-card class="shadow-md">
      <mat-card-header class="bg-primary/10 px-4 py-3">
        <mat-card-title class="text-lg font-medium">
          Comments ({{ parkingDetail.comments.length }})
        </mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div *ngIf="parkingDetail.comments.length === 0" class="text-center py-6 text-gray-500">
          No comments found
        </div>
        <div *ngFor="let comment of parkingDetail.comments; let last = last" class="mb-6 p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow">
          <div class="space-y-2">
            <div class="flex justify-between">
              <br>
              <span class="font-medium">Comment ID: </span>
              <span>{{ comment.comment_id }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">User: </span>
              <span>{{ comment.user_name || 'Guest' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Rating: </span>
              <span>{{ comment.rating }} / 5</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Comment: </span>
              <span>{{ comment.comment || 'No comment' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Vehicle Plate: </span>
              <span>{{ comment.vehicle_plate || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Order ID: </span>
              <span>{{ comment.order_id || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">User Phone: </span>
              <span>{{ comment.user_phone || '-' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Created At: </span>
              <span>{{ formatDate(comment.created_at) }}</span>
            </div>
          </div>
          <div class="mt-6 h-px bg-gray-200" *ngIf="!last"></div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</mat-dialog-content>